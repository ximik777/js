<!DOCTYPE html>
<html>
<head>
    <title></title>
    <title>loadManager</title>
    <meta charset="utf-8">
    <script type="text/javascript" src="../js/loadManager.js"></script>
    <script type="text/javascript">

        var loadManager = {
            loads:[],
            loading: [],
            turn: [],
            baseDomain: 'jt.gs',
            js:'/js/',
            css:'/css/',
            debugEnable: true,
            getJsrc: function(filename){
                with(loadManager){
                    return '//'+baseDomain+js+filename+'?'+(+new Date());
                }
            },
            loadRelations: function(module, configs){
                if(loadManager.inArray(module, loadManager.loads)) return false;

                for(var i in configs['js_relation']){
                    loadManager.load(configs['js_relation'][i]);
                }
            },
            load: function(module){
                try{
                    var config = jt_tree[module];
                    var relations = config['js_relation'];

                    var files = [];
                    for(var i in relations){

                    }
                    console.log(relations);
//                    loadManager.loadRelations(module,config);
//
//                    for(var i in config['js']){
//                        loadManager.addJS(module, config['js'][i]);
//                    }
                } catch (e) {
                    loadManager.debug(e);
                }
            },
            done: function(module){
                try{
                    if(jt_tree[module]){
                        loadManager.loads.push(module);
                        loadManager.debug('Module "'+module+'" is load!');
                    }
                } catch (e) {
                    loadManager.debug('Error load module: "'+module+'"', e);
                }

            },
            addJS: function(module, file_name){
                if(loadManager.inArray(module, loadManager.loading)) return;
                loadManager.loading.push(module);
                var head = document.getElementsByTagName('head')[0],
                    script = document.createElement('script');
                    script.setAttribute('type', 'text/javascript');
                    script.setAttribute('id', 'jt_module_'+module);
                    script.setAttribute('src', loadManager.getJsrc(file_name));
                    head.appendChild(script);
                    loadManager.debug('Include module: '+module);
            },
            addCSS: function(module, file_name){},
            inArray: function(value, arr) {
                return loadManager.indexOf(arr, value) != -1;
            },
            indexOf: function(arr, value, from) {
                for (var i = from || 0, l = (arr || []).length; i < l; i++) {
                    if (arr[i] == value) return i;
                }
                return -1;
            },
            debug: function(){
                if(!loadManager.debugEnable) return;
                var args = Array.prototype.slice.call(arguments);
                console.log(args);
            }
        };

        loadManager.load('dom');

    </script>
</head>
<body>

</body>
</html>